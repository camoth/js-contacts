/** @license js-contacts (c) 2020-2020 Liu.Jun License: MIT */
function t(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function e(t,e){if(null==t)return{};var o,n,i=function(t,e){if(null==t)return{};var o,n,i={},r=Object.keys(t);for(n=0;n<r.length;n++)o=r[n],e.indexOf(o)>=0||(i[o]=t[o]);return i}(t,e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(n=0;n<r.length;n++)o=r[n],e.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(t,o)&&(i[o]=t[o])}return i}function o(t){return function(t){if(Array.isArray(t))return n(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return n(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return n(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,n=new Array(e);o<e;o++)n[o]=t[o];return n}function i(t){return String(t)===t}!function(t,e){void 0===e&&(e={});var o=e.insertAt;if(t&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===o&&n.firstChild?n.insertBefore(i,n.firstChild):n.appendChild(i),i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t))}}('.xx-disHide{display:none!important}.contactsBox{position:relative;background:#fff}.contactsBox .c-search-icon{display:inline-block;width:.6667rem;height:.6667rem;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAAwCAMAAABpN6nPAAAAdVBMVEUAAAC6urqsrKy6urq7u7u7u7u6urq7u7u7u7u6urq6urq8vLy8vLy6urq6urq7u7u7u7u6urq6urq7u7u7u7u7u7u9vb26urq6urq7u7u6urq6urq6urq6urq7u7u8vLy7u7u6urq7u7u6urq7u7u9vb26uro15wGBAAAAJnRSTlMA7QX4rH0WEGz72VQ38+fRlYxpRz4yB8axc52bh3lhWxzhoU4pH65UEgAAAAEaSURBVEjH7ZXLGoIgEIUBJbyVqZl2v/P+jxhjLFSEYr6WnuWBH4YZGMisP2vD24TGAc3DXf0b8SpWsqfkJL4ii3UsR1ryrZtJqZxQkrmYo+xE7+dasO0ii8KgM4KzndlL0K3shSP4Z++djSlgNOZs6IpDR1n2SmFstTEHLkuIsJ7MG8RBn1NDFZwsZ8TUGpazpOkilSLTvwau4+4hcnMrDvVg1prDsVLDzpVb9g0z+NBYCrIt7FAGWTISpMyGOAS5vY68UnkHF9SoCeManpR3dEGtmvBAQajwUInApBxVXNQ1Ql1YzNNAPULMc0c0lob5tjBQyDybpab82nKhKb8PINKU11djo9yfmqY48ZGmWoKgUuKrqqjIrIHeA6M7aFBCwYoAAAAASUVORK5CYII=");background-size:.6667rem;background-repeat:no-repeat;background-position:50%;vertical-align:top}.contactsBox_search{position:relative;padding:.2667rem}.contactsBox_searchIcon{position:absolute;left:.4rem;top:.3733rem}.contactsBox_searchInput{display:block;width:100%;box-sizing:border-box!important;line-height:.4rem;padding:.2667rem .2667rem .2667rem .9333rem;font-size:14px;border:none;outline:none;background:#f2f2f2;border-radius:4px;-webkit-transition:box-shadow .4s ease;transition:box-shadow .4s ease}.contactsBox_searchInput::-webkit-input-placeholder{color:#bababa}.contactsBox_searchInput::placeholder{color:#bababa}.contactsBox_searchInput:focus{box-shadow:0 0 .08rem 0 rgba(0,0,0,.3)}.contactsBox_content{position:relative;height:100%}.hasSearchInput .contactsBox_content{height:auto}.contactsBox_listBox{overflow:auto;padding:0;-webkit-overflow-scrolling:touch}.contactsBox_groupTitle{margin:0;position:-webkit-sticky;position:sticky;top:0;padding:0 .2667rem;font-size:14px;font-weight:700;color:#000;line-height:1.0667rem;background:#e5e5e5}.contactsBox_groupItem{padding:0 .8rem 0 .2667rem}.contactsBox_groupItem:active{background-color:#efefef}.contactsBox_groupItem.xx-active .contactsBox_groupLabel{color:#ff8a00}.contactsBox_groupItem .contactsBox_groupLabel{display:block;font-size:14px;color:#000;line-height:1.28rem;border-bottom:.5px solid #eee}.contactsBox_keyBar{box-sizing:border-box!important;position:absolute;padding:.2667rem .08rem .2667rem 0;top:50%;-webkit-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);right:0;color:#007aff;max-height:100%}.contactsBox_keyBar>span{display:block;text-align:center;width:.48rem;line-height:.48rem;border-radius:50%;font-size:.32rem}.contactsBox_keyBar>span.xx-active{background:#007aff;color:#fff}.contactsBox_keyBar.contactsBox_keyBar-scroll{overflow:auto;-webkit-overflow-scrolling:touch}.contactsBox_keyBar.contactsBox_keyBar-touchmove>span{width:1.8vh;line-height:1.8vh;padding:.0533rem}.contactsBox_indicator{position:absolute;width:1.1733rem;height:1.1733rem;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);transform:translate(-50%,-50%);text-align:center;line-height:1.1733rem;background-color:#666;border-radius:.2133rem;color:#fff;font-size:17px}');var r,a,s=(r="".concat(+new Date),a=0,function(){var t="".concat(+new Date);return t===r?a+=1:a=0,"lj".concat(r=t,"x").concat(a)});function c(t,e,o){for(;e;){if(o(e))return e;if(e===t||e.parentNode===t)break;e=e.parentNode}return null}function l(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;if(t instanceof NodeList)return o(t);if(t instanceof HTMLElement)return[t];if(i(t))return o(e.querySelectorAll(t));throw new Error("请传入一个正确的选择器")}function u(t,e,o){var n,i,r,a=null,s=0,c=Object.assign({},o),l=function(){s=!1===c.leading?0:Date.now(),a=null,r=t.apply(n,i),a||(n=null,i=null)};return function(){var o=Date.now();s||!1!==c.leading||(s=o);var u=e-(o-s);n=this;for(var h=arguments.length,p=new Array(h),d=0;d<h;d++)p[d]=arguments[d];return i=p,u<=0||u>e?(a&&(clearTimeout(a),a=null),s=o,r=t.apply(n,i),a||(n=null,i=null)):a||(a=setTimeout(l,u)),r}}var h=function(){function n(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),function(t,e,o){e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o}(this,"options",{id:"",target:"",hotLetter:"#",hotName:"Hot",hotList:[],allList:[],groupedList:[],containerHeight:"60vh",showSearch:!0,navModel:"scroll",searchVal:"",curSelect:"",indicatorDuration:1500,isDestroy:!1,activeClassName:"xx-active"}),this.options.id=s(),this.resolveData(t),this.grouping(),this.render(),this.updatePosition()}var i,r,a;return i=n,(r=[{key:"callHook",value:function(t,e){this.options[t]&&this.options[t].call(null,e)}},{key:"throwError",value:function(t){throw new Error(t.message||t)}},{key:"optionNodeList2DataList",value:function(t){return o(t).reduce((function(t,e){if(""!==e.value){var o=e.innerText||e.textContent||e.text,n=e.dataset.groupKey||o;t.push({value:e.value,label:o,groupKey:n})}return t}),[])}},{key:"resolveSelectNodeData",value:function(t){var e=l(t)[0];e.classList.add("xx-disHide"),this.options.selectDom=e;var o=e.querySelector("[data-type=hot]"),n=Object.create(null);if(o){n.hotList=this.optionNodeList2DataList(o.querySelectorAll("option"));var i=e.querySelector("[data-type=all]");i&&(n.allList=this.optionNodeList2DataList(i.querySelectorAll("option")))}else n.allList=this.optionNodeList2DataList(e.querySelectorAll("option"));return n}},{key:"resolveData",value:function(t){var o=t.data,n=e(t,["data"]);if(o||this.throwError("构造函数参数必须包含 [data] 属性"),o.selectDom){var i=this.resolveSelectNodeData(o.selectDom);Object.assign(this.options,n,i)}else o.allList||this.throwError("构造函数参数data属性必须包含 [selectDom] 或者 [allList]"),Object.assign(this.options,n,o)}},{key:"grouping",value:function(){var t,e,n,i=this.options.hotList&&this.options.hotList.length>0;this.options.groupedList=[].concat(o(i?[{isHot:!0,name:this.options.hotName,letter:this.options.hotLetter,value:this.options.hotList,anchorPoint:"".concat(this.options.id,"_").concat(this.options.hotName)}]:[]),o((t=this.options.allList,e=this.options.id,n=Object.create(null),t.reduce((function(t,o){var i=String((o.groupKey||o.label)[0]).toLocaleUpperCase();return void 0!==n[i]?t[n[i]].value.push(o):(n[i]=t.length,t.push({name:i,letter:i,value:[o],anchorPoint:"".concat(e,"_").concat(i)})),t}),[]))))}},{key:"render",value:function(){var t,e,o,n=(t=this.options,e=function(e){return'\n        <div class="js_contactsBoxGroupItem contactsBox_groupItem '.concat(t.curSelect===e.value?t.activeClassName:"",'"\n            data-value="').concat(e.value,'"\n        >\n            <span class="contactsBox_groupLabel">').concat(e.label,"</span>\n        </div>")},o=t.showSearch?"calc(".concat(t.containerHeight," - 1.4668rem)"):"100%",'\n<div class="contactsBox '.concat(t.showSearch?"hasSearchInput":"",'" style="height: ').concat(t.containerHeight,'">\n    ').concat(t.showSearch?'<div class="contactsBox_search">\n        <span class="c-search-icon contactsBox_searchIcon"></span>\n        <input placeholder="Enter keywords" class="contactsBox_searchInput">\n    </div>':"",'\n    <div class="contactsBox_content">\n        <div class="contactsBox_listBox js_contactsBoxListBox" style="height: ').concat(o,'">\n            ').concat(t.groupedList.map((function(t){var o=t.name,n=t.anchorPoint,i=t.isHot,r=t.value,a=void 0===r?[]:r;return'\n        <div class="js_contactsBoxGroup contactsBox_group'.concat(i?" contactsBox_group-hot":"",'" id="').concat(n,'">\n            <h4 class="js_contactsBoxGroupTitle contactsBox_groupTitle">').concat(o,'</h4>\n            <div class="contactsBox_groupList">\n                ').concat(a.map(e).join(""),"\n            </div>\n        </div>\n        ")})).join(""),'\n        </div>\n        <div class="js_contactsBoxKeyBar contactsBox_keyBar contactsBox_keyBar-').concat(t.navModel,'">\n            ').concat(t.groupedList.map((function(e,o){return'\n                <span data-target="'.concat(e.anchorPoint,'" class="js_keyBarItem ').concat(0===o?t.activeClassName:"",'">').concat(e.letter,"</span>\n            ")})).join(""),'\n        </div>\n    </div>\n    <div class="js_indicator contactsBox_indicator" style="display: none;">#</div>\n</div>\n')),i=l(this.options.target)[0];i.insertAdjacentHTML("afterbegin",n),this.options.targetDom=i,this.options.scrollDom=i.querySelector(".js_contactsBoxListBox"),this.options.indicatorDom=i.querySelector(".js_indicator"),this.bindEvent(i)}},{key:"setKeyBarSelect",value:function(t){var e=this.options.targetDom.querySelector(".js_keyBarItem.".concat(this.options.activeClassName));e&&e.classList.remove(this.options.activeClassName),t.classList.add(this.options.activeClassName)}},{key:"handleIndicator",value:function(t){var e=this;this.options.indicatorDom.innerText=t.innerText,this.options.indicatorDom.style.display="block",clearTimeout(this.$$indicatorTimer),this.$$indicatorTimer=setTimeout((function(){e.options.indicatorDom.style.display="none",e.$$indicatorTimer=null}),this.options.indicatorDuration)}},{key:"handleAnchorPoint",value:function(t){this.setKeyBarSelect(t),this.handleIndicator(t);var e=t.dataset.target,o=this.options.groupedList.find((function(t){return t.anchorPoint===e}));this.options.scrollDom.scrollTop=o.positionTop,this.callHook("onScrollToAnchorPoint",t)}},{key:"handleSelect",value:function(t){var e=this;l(".js_contactsBoxGroupItem.".concat(this.options.activeClassName),this.options.targetDom).forEach((function(t){return t.classList.remove(e.options.activeClassName)}));var o=t.dataset.value;l(".js_contactsBoxGroupItem[data-value=".concat(t.dataset.value,"]"),this.options.targetDom).forEach((function(t){return t.classList.add(e.options.activeClassName)})),this.options.curSelect=o,this.callHook("onSelect",o)}},{key:"updatePosition",value:function(){var t=this;!this.options.allList.length>0||l(".js_contactsBoxGroup",this.options.targetDom).forEach((function(e,o){t.options.groupedList[o].positionTop=e.offsetTop}))}},{key:"getCurrentSection",value:function(t){for(var e=this.options.groupedList.length-1;e>=0;e-=1){var o=this.options.groupedList[e];if(o.positionTop<=t)return o}return this.options.groupedList[this.options.groupedList.length-1]}},{key:"scrollChange",value:function(t){if(!this.isDestroy){var e=(t&&t.target||this.options.scrollDom).scrollTop,o=this.getCurrentSection(e);this.setKeyBarSelect(this.options.targetDom.querySelector(".js_keyBarItem[data-target=".concat(o.anchorPoint,"]")))}}},{key:"bindEvent",value:function(t){var e=this;if(this.$$clickEvent=function(t){c(t.currentTarget,t.target,(function(t){return!(!t.className||!~t.className.indexOf("contactsBox_groupItem")||(e.handleSelect(t),0))}))},t.addEventListener("click",this.$$clickEvent,!1),this.$$touchstartEvent=function(t){c(t.currentTarget,t.target,(function(t){return!(!t.className||!~t.className.indexOf("js_keyBarItem")||(e.handleAnchorPoint(t),0))}))},t.addEventListener("touchstart",this.$$touchstartEvent,!1),this.$$scrollEvent=u(this.scrollChange.bind(this),250),this.options.scrollDom.addEventListener("scroll",this.$$scrollEvent,!1),this.$$resizeEvent=u((function(){e.isDestroy||(e.updatePosition(),e.scrollChange())}),250),window.addEventListener("resize",this.$$resizeEvent,!1),"touchmove"===this.options.navModel){this.$$navTouchMoveEvent=u((function(t){if(!e.isDestroy){t.preventDefault();var o=document.elementFromPoint(t.changedTouches[0].clientX,t.changedTouches[0].clientY);o&&o.classList&&o.classList.contains("js_keyBarItem")&&e.handleAnchorPoint(o)}}),50);var o=this.options.targetDom.querySelector(".js_contactsBoxKeyBar");o.addEventListener("touchstart",this.$$navTouchMoveEvent,!1),o.addEventListener("touchmove",this.$$navTouchMoveEvent,!1)}}},{key:"destroy",value:function(){this.isDestroy=!0,clearTimeout(this.$$indicatorTimer),this.options.targetDom.removeEventListener("click",this.$$clickEvent,!1),this.options.targetDom.removeEventListener("click",this.$$touchstartEvent,!1),this.options.scrollDom.removeEventListener("scroll",this.$$scrollEvent,!1);var t=this.options.targetDom.querySelector(".js_contactsBoxKeyBar");t.removeEventListener("touchstart",this.$$navTouchMoveEvent,!1),t.removeEventListener("touchmove",this.$$navTouchMoveEvent,!1),window.removeEventListener("resize",this.$$resizeEvent,!1),this.$$clickEvent=null,this.$$touchstartEvent=null,this.$$scrollEvent=null,this.$$navTouchMoveEvent=null,this.$$resizeEvent=null,this.options.selectDom&&this.options.selectDom.classList.remove("xx-disHide"),this.options.targetDom.removeChild(this.options.targetDom.firstElementChild),this.options=null}}])&&t(i.prototype,r),a&&t(i,a),n}();export default h;
